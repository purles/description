<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edytor opis√≥w produkt√≥w Purles</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    
    h1, h2, h3 {
      margin-bottom: 15px;
    }
    
    .section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    
    .row {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #eee;
      border-radius: 5px;
      background-color: #f9f9f9;
      position: relative;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    input, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: Arial, sans-serif;
    }
    
    textarea {
      resize: vertical;
      font-family: monospace;
      white-space: pre-wrap;
      min-height: 100px;
      overflow-y: hidden; /* Ukryj domy≈õlny scrollbar */
    }
    
    /* Usu≈Ñ przyciski akcji na dole, bo sƒÖ ju≈º na g√≥rze */
    .actions {
      display: none;
    }
    
    button {
      padding: 8px 15px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    button:hover {
      background-color: #45a049;
    }
    
    button.delete {
      background-color: #f44336;
    }
    
    button.delete:hover {
      background-color: #d32f2f;
    }
    
    button.preview {
      background-color: #2196F3;
    }
    
    button.preview:hover {
      background-color: #0b7dda;
    }
    
    button.copy {
      background-color: #ff9800;
    }
    
    button.copy:hover {
      background-color: #e68a00;
    }
    
    .toolbar {
      position: sticky;
      top: 0;
      background-color: #333;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      z-index: 100;
    }
    
    .toolbar button {
      width: 40px;
      height: 40px;
      font-size: 16px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #555;
    }
    
    .toolbar button.action-btn {
      width: auto;
      padding: 0 15px;
      white-space: nowrap;
    }
    
    .toolbar button:hover {
      background-color: #777;
    }
    
    .toolbar .divider {
      width: 1px;
      background-color: #777;
      margin: 0 5px;
    }
    
    .img-preview {
      max-width: 150px;
      max-height: 150px;
      margin-top: 10px;
      border: 1px solid #ddd;
      display: none;
    }
    
    .row-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .link-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 1000;
      display: none;
    }
    
    .link-popup input {
      margin-bottom: 10px;
    }
    
    .link-popup .buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0,0,0,0.5);
      z-index: 999;
      display: none;
    }
    
    /* Specjalne style dla przycisk√≥w "dodaj sekcjƒô" wewnƒÖtrz wiersza */
    .add-inline {
      background-color: #4CAF50;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <!-- Pasek narzƒôdzi -->
  <div class="toolbar">
    <button type="button" onclick="formatText('bold')" title="Pogrubienie">B</button>
    <button type="button" onclick="formatText('italic')" title="Kursywa">I</button>
    <button type="button" onclick="formatText('underline')" title="Podkre≈õlenie">U</button>
    <div class="divider"></div>
    <button type="button" onclick="formatText('link')" title="Link">üîó</button>
    <button type="button" onclick="formatText('ul')" title="Lista punktowana">‚Ä¢</button>
    <button type="button" onclick="formatText('ol')" title="Lista numerowana">1.</button>
    <button type="button" onclick="formatText('strong')" title="Wyr√≥≈ºnienie">S</button>
    <button type="button" onclick="formatText('em')" title="Emfaza">E</button>
    <div class="divider"></div>
    <div style="flex-grow: 1;"></div>
    <button type="button" id="generate-preview" class="preview action-btn" title="PodglƒÖd w nowym oknie">üëÅÔ∏è PodglƒÖd</button>
    <button type="button" id="copy-html" class="copy action-btn" title="Kopiuj kod HTML">üìã Kopiuj HTML</button>
  </div>
  
  <!-- Popup do wstawiania link√≥w -->
  <div class="overlay" id="overlay"></div>
  <div class="link-popup" id="linkPopup">
    <h3>Wstaw link</h3>
    <label for="linkUrl">URL:</label>
    <input type="text" id="linkUrl" placeholder="https://example.com">
    <label for="linkText">Tekst:</label>
    <input type="text" id="linkText" placeholder="Tekst linku">
    <div class="buttons">
      <button type="button" onclick="closePopup()">Anuluj</button>
      <button type="button" onclick="insertLink()">Wstaw</button>
    </div>
  </div>
  
  <div class="container">
    <h1>Edytor opis√≥w produkt√≥w Purles</h1>
    
    <!-- Sekcja 1: Opis g≈Ç√≥wny -->
    <div class="section" id="description-section">
      <h2>1. Opis g≈Ç√≥wny</h2>
      
      <div id="description-rows">
        <!-- Wiersze opisu bƒôdƒÖ dodawane dynamicznie -->
      </div>
      
      <button type="button" id="add-description-row">Dodaj nowƒÖ sekcjƒô opisu</button>
      
      <div class="form-group" style="margin-top: 20px;">
        <label>Nag≈Ç√≥wek rezultat√≥w:</label>
        <input type="text" id="results-headline" value="Rezultaty:">
      </div>
      
      <div class="form-group">
        <label>Tre≈õƒá rezultat√≥w (HTML):</label>
        <textarea id="results-content" class="html-content"><ul>
<li><strong>100%</strong>&nbsp;os√≥b badanych potwierdzi≈Ço, ≈ºe po zastosowaniu produktu sk√≥ra jest w spos√≥b widoczny nawil≈ºona.*</li>
<li><strong>100%</strong>&nbsp;os√≥b badanych zauwa≈ºy≈Ço, ≈ºe po zastosowaniu produktu nie ma odczucia przesuszenia sk√≥ry, poniewa≈º&nbsp; bariera ochronna jest odbudowana.*</li>
</ul>
<small>* Badanie wykonano na grupie 20 os√≥b.</small></textarea>
      </div>
    </div>
    
    <!-- Sekcja 2: Sk≈Çad -->
    <div class="section" id="composition-section">
      <h2>2. Sk≈Çad</h2>
      
      <div class="form-group">
        <label>Nag≈Ç√≥wek sk≈Çadnik√≥w:</label>
        <input type="text" id="composition-headline" value="Sk≈Çadniki aktywne:">
      </div>
      
      <div id="ingredients-container">
        <!-- Sk≈Çadniki bƒôdƒÖ dodawane dynamicznie -->
      </div>
      
      <button type="button" id="add-ingredient">Dodaj sk≈Çadnik aktywny</button>
      
      <div class="form-group" style="margin-top: 20px;">
        <label>Pe≈Çen sk≈Çad INCI (HTML):</label>
        <textarea id="inci-content" class="html-content"><strong>Pe≈Çen sk≈Çad (INCI):</strong> Aqua (Water), Paraffinum Liquidum (Mineral Oil), Glycerin, Cetearyl Isononanoate, Cetyl Alcohol, Tapioca Starch, Glyceryl Stearate, PEG-100 Stearate, Pentylene Glycol, Alpha-Glucan Oligosaccharide, Olea Europaea (Olive) Fruit Oil, Capryloyl Glycine, Argania Spinosa Kernel Oil, Parfum (Fragrance), Simmondsia Chinensis (Jojoba) Seed Oil, Propylene Glycol, Carbomer, Xanthan Gum, 1,2-Hexanediol, Caprylyl Glycol, Sodium Hydroxide, Tocopheryl Acetate, Hexamethylindanopyran, Linalyl Acetate, Calendula Officinalis Flower Extract</textarea>
      </div>
    </div>
    
    <!-- Sekcja 3: Cechy produktu -->
    <div class="section" id="features-section">
      <h2>3. Cechy produktu</h2>
      
      <div class="form-group">
        <label>Nag≈Ç√≥wek sekcji:</label>
        <input type="text" id="features-headline" value="Cechy produktu:">
      </div>
      
      <div id="features-container">
        <!-- Cechy bƒôdƒÖ dodawane dynamicznie -->
      </div>
      
      <button type="button" id="add-feature">Dodaj cechƒô produktu</button>
    </div>
    
    <!-- Akcje -->
    <div class="actions">
      <button type="button" id="generate-preview" class="preview">PodglƒÖd w nowym oknie</button>
      <button type="button" id="copy-html" class="copy">Kopiuj kod HTML</button>
    </div>
  </div>

  <script>
    // Dane poczƒÖtkowe
    const initialData = {
      description: {
        rows: [
          {
            imageUrl: "https://shop49275-1.iai-shop.com/data/include/cms/wdrozenie/opisy/image_58.webp?v=1744110330378",
            headline: "Krem Ochrona Mikrobiomu...",
            content: "‚Ä¶ma dzia≈Çanie ochronne i wielokierunkowe. Specjalny <strong>kompleks prebiotyczny wzmacnia naturalny mikrobiom sk√≥ry</strong> poprzez stymulacjƒô wzrostu po≈ºytecznych bakterii. Oleje zawarte w formule bogate sƒÖ w NNKT, witaminy i antyoksydanty. OdpowiadajƒÖ za <strong>odbudowƒô sk√≥rnej bariery ochronnej,</strong> hamujƒÖc jednocze≈õnie nadmiernƒÖ utratƒô wody i przyczyniajƒÖc siƒô tym samym do <strong>zwiƒôkszenia</strong> poziomu <strong>nawil≈ºenia.</strong> Ekstrakt z nagietka potƒôguje <strong>dzia≈Çanie ≈ÇagodzƒÖce.</strong> Krem <strong>chroni sk√≥rƒô</strong> przed negatywnymi czynnikami zewnƒôtrznymi, <strong>zmniejsza ≈Çuszczenie siƒô i pƒôkanie suchej sk√≥ry. Stosuj rano i / lub wieczorem.</strong>"
          },
          {
            imageUrl: "https://shop49275-1.iai-shop.com/data/include/cms/wdrozenie/opisy/image_59.webp?v=1744110330378",
            headline: "Wskazania:",
            content: "<ul>\n<li>sk√≥ra wra≈ºliwa, nadreaktywna, alergiczna,</li>\n<li>sk√≥ra ze sk≈Çonno≈õciƒÖ do silnego przesuszenia lub atopii,</li>\n<li>zaburzenia r√≥wnowagi sk√≥ry  wynikajƒÖce z terapii dermatologicznych, a tak≈ºe inwazyjnych zabieg√≥w kosmetycznych.</li>\n</ul>"
          },
          {
            imageUrl: "https://shop49275-1.iai-shop.com/data/include/cms/wdrozenie/opisy/image_60.webp?v=1744110330378",
            headline: "Dzia≈Çanie:",
            content: "<ul>\n<li>przywraca r√≥wnowagƒô sk√≥rnej mikrobioty,</li>\n<li>wzmacnia barierƒô ochronnƒÖ sk√≥ry,</li>\n<li>intensywnie nawil≈ºa,</li>\n<li>od≈ºywia,</li>\n<li>zmiƒôkcza,</li>\n<li>redukuje szorstko≈õƒá,</li>\n<li>≈Çagodzi podra≈ºnienia.</li>\n</ul>"
          }
        ]
      },
      composition: {
        content: [
          "<strong>Bioecolia -</strong> polisacharyd (Œ±-glukan) otrzymany opatentowanƒÖ metodƒÖ enzymatycznej syntezy z cukr√≥w naturalnych. Chroni i stymuluje naturalnƒÖ zdolno≈õƒá obronnƒÖ sk√≥ry poprzez dzia≈Çanie jako bioselektywny substrat (prebiotyk) dla po≈ºytecznych mikroorganizm√≥w, kosztem patogen√≥w. Bioecolia r√≥wnowa≈ºy i stymuluje mikrobiotƒô sk√≥ry, wspomagajƒÖc pierwszƒÖ liniƒô obrony przed atakiem z zewnƒÖtrz.",
          "<strong>Oliwa z oliwek&nbsp;‚Äì</strong> w wiƒôkszo≈õci sk≈Çada siƒô z kwasu oleinowego, kt√≥ry tworzy na powierzchni sk√≥ry delikatnƒÖ warstwƒô ochronnƒÖ, przeciwdzia≈ÇajƒÖc utracie wody. W sk≈Çadzie oliwy obecny jest tak≈ºe kwas linolowy, kt√≥ry redukuje stany zapalne oraz normalizuje proces rogowacenia nask√≥rka. W oliwie znajdziemy r√≥wnie≈º polifenole o w≈Ça≈õciwo≈õciach antyoksydacyjnych i przeciwzapalnych. Oliwa z oliwek zmiƒôkcza i ≈õwietnie ≈Çagodzi podra≈ºnienia wysuszonej sk√≥ry."
        ]
      },
      features: {
        items: [
          {
            iconUrl: "https://shop49275-1.iai-shop.com/data/include/cms/wdrozenie/ikony/cruelty_free_1x.webp?v=1744108211366",
            text: "Przyjazny zwierzƒôtom"
          },
          {
            iconUrl: "https://shop49275-1.iai-shop.com/data/include/cms/wdrozenie/ikony/natural_origin_1x.webp?v=1744108211366",
            text: "DominujƒÖ sk≈Çadniki naturalnego pochodzenia"
          },
          {
            iconUrl: "https://shop49275-1.iai-shop.com/data/include/cms/wdrozenie/ikony/paraben_free_1x.webp?v=1744108211365",
            text: "Nie zawiera paraben√≥w"
          }
        ]
      }
    };
    
    // Zmienna do przechowywania aktywnego elementu
    let activeElement = null;
    
    // Funkcja do formatowania tekstu
    function formatText(command) {
      if (!activeElement) {
        alert('Najpierw zaznacz pole tekstowe!');
        return;
      }
      
      // Pobierz aktualne zaznaczenie
      const start = activeElement.selectionStart;
      const end = activeElement.selectionEnd;
      const selectedText = activeElement.value.substring(start, end);
      
      let formattedText = '';
      
      switch (command) {
        case 'bold':
          formattedText = `<strong>${selectedText}</strong>`;
          break;
        case 'italic':
          formattedText = `<em>${selectedText}</em>`;
          break;
        case 'underline':
          formattedText = `<u>${selectedText}</u>`;
          break;
        case 'strong':
          formattedText = `<strong>${selectedText}</strong>`;
          break;
        case 'em':
          formattedText = `<em>${selectedText}</em>`;
          break;
        case 'ul':
          if (selectedText.trim() === '') {
            formattedText = "<ul>\n<li></li>\n</ul>";
          } else {
            const lines = selectedText.split('\n');
            formattedText = "<ul>\n" + lines.map(line => `<li>${line.trim()}</li>`).join('\n') + "\n</ul>";
          }
          break;
        case 'ol':
          if (selectedText.trim() === '') {
            formattedText = "<ol>\n<li></li>\n</ol>";
          } else {
            const lines = selectedText.split('\n');
            formattedText = "<ol>\n" + lines.map(line => `<li>${line.trim()}</li>`).join('\n') + "\n</ol>";
          }
          break;
        case 'link':
          // Otw√≥rz popup do wstawiania linku
          document.getElementById('linkText').value = selectedText;
          document.getElementById('overlay').style.display = 'block';
          document.getElementById('linkPopup').style.display = 'block';
          return;
      }
      
      // Wstaw sformatowany tekst
      if (formattedText) {
        activeElement.value = activeElement.value.substring(0, start) + formattedText + activeElement.value.substring(end);
        
        // Ustaw nowƒÖ pozycjƒô kursora
        const newCursorPos = start + formattedText.length;
        activeElement.setSelectionRange(newCursorPos, newCursorPos);
      }
    }
    
    // Funkcja do wstawiania linku
    function insertLink() {
      const linkUrl = document.getElementById('linkUrl').value;
      const linkText = document.getElementById('linkText').value || linkUrl;
      
      if (!linkUrl) {
        alert('Podaj URL linku!');
        return;
      }
      
      const formattedLink = `<a href="${linkUrl}">${linkText}</a>`;
      
      if (activeElement) {
        const start = activeElement.selectionStart;
        const end = activeElement.selectionEnd;
        
        activeElement.value = activeElement.value.substring(0, start) + formattedLink + activeElement.value.substring(end);
      }
      
      closePopup();
    }
    
    // Funkcja do zamykania popupu
    function closePopup() {
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('linkPopup').style.display = 'none';
      document.getElementById('linkUrl').value = '';
    }
    
    // Funkcja do dodawania wiersza opisu
    function addDescriptionRow(imageUrl = "", headline = "", content = "", afterElement = null) {
      const container = document.getElementById("description-rows");
      const rowId = "desc-row-" + Date.now();
      
      const rowHtml = `
        <div class="row" id="${rowId}">
          <div class="form-group">
            <label>URL obrazka:</label>
            <input type="text" class="desc-image" value="${imageUrl}" onchange="updateImagePreview(this)">
            <img src="${imageUrl}" class="img-preview" style="${imageUrl ? 'display:block' : ''}">
          </div>
          
          <div class="form-group">
            <label>Nag≈Ç√≥wek:</label>
            <input type="text" class="desc-headline" value="${headline}">
          </div>
          
          <div class="form-group">
            <label>Tre≈õƒá (HTML):</label>
            <textarea class="desc-content html-content">${content}</textarea>
          </div>
          
          <div class="row-actions">
            <button type="button" class="delete" onclick="removeElement('${rowId}')">Usu≈Ñ sekcjƒô</button>
            <button type="button" class="add-inline" onclick="addDescriptionRow('', '', '', document.getElementById('${rowId}'))">Dodaj sekcjƒô po tej</button>
          </div>
        </div>
      `;
      
      if (afterElement) {
        afterElement.insertAdjacentHTML('afterend', rowHtml);
      } else {
        container.insertAdjacentHTML('beforeend', rowHtml);
      }
      
      // Dodaj listener dla tekst√≥w
      const newRow = document.getElementById(rowId);
      setupTextareaListeners(newRow.querySelector('.html-content'));
    }
    
    // Funkcja do aktualizacji podglƒÖdu obrazka
    function updateImagePreview(input) {
      const preview = input.nextElementSibling;
      if (input.value) {
        preview.src = input.value;
        preview.style.display = 'block';
      } else {
        preview.style.display = 'none';
      }
    }
    
    // Funkcja do dodawania sk≈Çadnika
    function addIngredient(content = "", afterElement = null) {
      const container = document.getElementById("ingredients-container");
      const ingredientId = "ingredient-" + Date.now();
      
      const ingredientHtml = `
        <div class="row" id="${ingredientId}">
          <div class="form-group">
            <label>Sk≈Çadnik (HTML):</label>
            <textarea class="ingredient-content html-content">${content}</textarea>
          </div>
          
          <div class="row-actions">
            <button type="button" class="delete" onclick="removeElement('${ingredientId}')">Usu≈Ñ sk≈Çadnik</button>
            <button type="button" class="add-inline" onclick="addIngredient('', document.getElementById('${ingredientId}'))">Dodaj sk≈Çadnik po tym</button>
          </div>
        </div>
      `;
      
      if (afterElement) {
        afterElement.insertAdjacentHTML('afterend', ingredientHtml);
      } else {
        container.insertAdjacentHTML('beforeend', ingredientHtml);
      }
      
      // Dodaj listener dla tekstu
      const newRow = document.getElementById(ingredientId);
      setupTextareaListeners(newRow.querySelector('.html-content'));
    }
    
    // Funkcja do dodawania cechy produktu
    function addFeature(iconUrl = "", text = "", afterElement = null) {
      const container = document.getElementById("features-container");
      const featureId = "feature-" + Date.now();
      
      const featureHtml = `
        <div class="row" id="${featureId}">
          <div class="form-group">
            <label>URL ikony:</label>
            <input type="text" class="feature-icon" value="${iconUrl}" onchange="updateImagePreview(this)">
            <img src="${iconUrl}" class="img-preview" style="${iconUrl ? 'display:block' : ''}">
          </div>
          
          <div class="form-group">
            <label>Tekst cechy:</label>
            <input type="text" class="feature-text" value="${text}">
          </div>
          
          <div class="row-actions">
            <button type="button" class="delete" onclick="removeElement('${featureId}')">Usu≈Ñ cechƒô</button>
            <button type="button" class="add-inline" onclick="addFeature('', '', document.getElementById('${featureId}'))">Dodaj cechƒô po tej</button>
          </div>
        </div>
      `;
      
      if (afterElement) {
        afterElement.insertAdjacentHTML('afterend', featureHtml);
      } else {
        container.insertAdjacentHTML('beforeend', featureHtml);
      }
    }
    
    // Funkcja do usuwania elementu
    function removeElement(elementId) {
      const element = document.getElementById(elementId);
      if (element) {
        element.remove();
      }
    }
    
    // Funkcja do generowania HTML
    function generateHtml() {
      let html = '';
      
      // 1. Opis g≈Ç√≥wny
      html += '<!-- ZAK≈ÅADKA OPIS -->\n';
      html += '<div id="description" class="desc">\n';
      
      // Wiersze opisu
      const descRows = document.querySelectorAll("#description-rows .row");
      descRows.forEach(row => {
        const imageUrl = row.querySelector('.desc-image').value;
        const headline = row.querySelector('.desc-headline').value;
        const content = row.querySelector('.desc-content').value;
        
        html += '  <div class="desc__row">\n';
        html += '    <div class="desc__image">\n';
        html += `      <img src="${imageUrl}" alt="" loading="lazy">\n`;
        html += '    </div>\n';
        html += '    <div class="desc__content">\n';
        html += `      <h3 class="desc__headline">${headline}</h3>\n`;
        html += `      <p>\n        ${content}\n      </p>\n`;
        html += '    </div>\n';
        html += '  </div>\n';
      });
      
      // Rezultaty
      const resultsHeadline = document.getElementById('results-headline').value;
      const resultsContent = document.getElementById('results-content').value;
      
      html += '  <div class="desc__results">\n';
      html += `    <h3 class="desc__headline">${resultsHeadline}</h3>\n`;
      html += `    ${resultsContent}\n`;
      html += '  </div>\n';
      html += '</div>\n\n';
      
      // 2. Sk≈Çad
      html += '<!-- ZAK≈ÅADKA SK≈ÅAD -->\n';
      html += '<div id="composition" class="desc">\n';
      
      // Nag≈Ç√≥wek sk≈Çadnik√≥w
      const compositionHeadline = document.getElementById('composition-headline').value;
      html += `  <h3 class="desc__headline">${compositionHeadline}</h3>\n`;
      
      // Sk≈Çadniki
      const ingredients = document.querySelectorAll("#ingredients-container .row");
      ingredients.forEach(ingredient => {
        const content = ingredient.querySelector('.ingredient-content').value;
        html += `  <p>${content}</p>\n`;
      });
      
      // INCI
      const inciContent = document.getElementById('inci-content').value;
      html += '  <div class="desc__results">\n';
      html += `    <p>${inciContent}</p>\n`;
      html += '  </div>\n';
      html += '</div>\n\n';
      
      // 3. Cechy produktu
      html += '<!-- ZAK≈ÅADKA CECHY PRODUKTU -->\n';
      html += '<div id="feature" class="desc">\n';
      
      // Nag≈Ç√≥wek cech
      const featuresHeadline = document.getElementById('features-headline').value;
      html += `  <h3 class="desc__headline">${featuresHeadline}</h3>\n`;
      html += '  <div class="desc__features">\n';
      
      // Cechy
      const features = document.querySelectorAll("#features-container .row");
      features.forEach(feature => {
        const iconUrl = feature.querySelector('.feature-icon').value;
        const text = feature.querySelector('.feature-text').value;
        
        html += '    <div class="desc__feature">\n';
        html += `      <div class="desc__icon"><img src="${iconUrl}" alt="" loading="lazy"></div><span>${text}</span></div>\n`;
      });
      
      html += '  </div>\n';
      html += '</div>';
      
      return html;
    }
    
    // Funkcja do otwierania podglƒÖdu w nowym oknie
    function openPreview() {
      const html = generateHtml();
      
      // CSS dla podglƒÖdu
      const css = `
        .desc {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          max-width: 1000px;
          margin: 0 auto;
          padding: 20px;
        }
        
        .desc__row {
          display: flex;
          margin-bottom: 2rem;
          align-items: flex-start;
        }
        
        .desc__image {
          flex: 0 0 200px;
          margin-right: 1.5rem;
        }
        
        .desc__image img {
          max-width: 100%;
          height: auto;
        }
        
        .desc__content {
          flex: 1;
        }
        
        .desc__headline {
          font-size: 1.25rem;
          font-weight: 600;
          margin-bottom: 0.75rem;
        }
        
        .desc ul {
          padding-left: 1.5rem;
          margin-bottom: 1rem;
        }
        
        .desc__results {
          margin-top: 1.5rem;
          padding: 1rem;
          background-color: #f9f9f9;
          border-radius: 0.375rem;
        }
        
        .desc__features {
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
        }
        
        .desc__feature {
          display: flex;
          align-items: center;
          flex: 0 0 calc(25% - 1rem);
          min-width: 200px;
        }
        
        .desc__icon {
          width: 40px;
          height: 40px;
          margin-right: 0.5rem;
        }
        
        .desc__icon img {
          max-width: 100%;
          height: auto;
        }
        
        @media (max-width: 768px) {
          .desc__row {
            flex-direction: column;
          }
          
          .desc__image {
            margin-right: 0;
            margin-bottom: 1rem;
            flex: none;
            width: 100%;
          }
          
          .desc__feature {
            flex: 0 0 100%;
          }
        }
      `;
      
      // Otw√≥rz nowe okno i dodaj tre≈õƒá HTML
      const previewWindow = window.open('', '_blank');
      previewWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>PodglƒÖd opisu produktu</title>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <style>${css}</style>
        </head>
        <body>
          ${html}
        </body>
        </html>
      `);
      previewWindow.document.close();
    }
    
    // Funkcja do ustawienia aktywnego elementu i auto-resize
    function setupTextareaListeners(textarea) {
      textarea.addEventListener('focus', function() {
        activeElement = this;
      });
      
      textarea.addEventListener('blur', function() {
        // Nie resetujemy activeElement tutaj, aby mo≈ºna by≈Ço u≈ºywaƒá przycisk√≥w po klikniƒôciu na nie
      });
      
      // Auto-resize dla textarea
      textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
      });
      
      // Inicjalne ustawienie wysoko≈õci
      setTimeout(function() {
        textarea.style.height = 'auto';
        textarea.style.height = (textarea.scrollHeight) + 'px';
      }, 0);
    }
    
    // Inicjalizacja strony
    document.addEventListener('DOMContentLoaded', function() {
      // Dodaj poczƒÖtkowe dane
      initialData.description.rows.forEach(row => {
        addDescriptionRow(row.imageUrl, row.headline, row.content);
      });
      
      initialData.composition.content.forEach(content => {
        addIngredient(content);
      });
      
      initialData.features.items.forEach(item => {
        addFeature(item.iconUrl, item.text);
      });
      
      // Obs≈Çuga przycisk√≥w
      document.getElementById('add-description-row').addEventListener('click', function() {
        addDescriptionRow();
      });
      
      document.getElementById('add-ingredient').addEventListener('click', function() {
        addIngredient('<strong>Nowy sk≈Çadnik</strong> - opis sk≈Çadnika');
      });
      
      document.getElementById('add-feature').addEventListener('click', function() {
        addFeature('', 'Nowa cecha produktu');
      });
      
      // Przyciski w toolbarze
      document.getElementById('generate-preview').addEventListener('click', openPreview);
      
      document.getElementById('copy-html').addEventListener('click', function() {
        const html = generateHtml();
        navigator.clipboard.writeText(html)
          .then(() => alert('Kod HTML zosta≈Ç skopiowany do schowka!'))
          .catch(err => {
            console.error('B≈ÇƒÖd podczas kopiowania:', err);
            alert('Nie uda≈Ço siƒô skopiowaƒá kodu. Spr√≥buj rƒôcznie zaznaczyƒá i skopiowaƒá.');
          });
      });
      
      // Usu≈Ñ przyciski na dole, bo sƒÖ ju≈º na g√≥rze
      
      // Dodaj nas≈Çuchiwacze zdarze≈Ñ dla wszystkich p√≥l tekstowych z klasƒÖ html-content
      document.querySelectorAll('.html-content').forEach(textarea => {
        setupTextareaListeners(textarea);
      });
      
      // Dodaj nas≈Çuchiwacz dla rezultat√≥w
      setupTextareaListeners(document.getElementById('results-content'));
      setupTextareaListeners(document.getElementById('inci-content'));
      
      // Zamykanie popupu po klikniƒôciu w overlay
      document.getElementById('overlay').addEventListener('click', closePopup);
    });
  </script>
</body>
</html>

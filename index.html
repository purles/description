<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edytor opis√≥w produkt√≥w Purles v2</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    
    h1, h2, h3 {
      margin-bottom: 15px;
    }
    
    .section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    
    /* Bardziej wyra≈∫ne oddzielenie rzƒôd√≥w */
    .row {
      margin-bottom: 25px;
      padding: 15px;
      border: 2px solid #aaa;
      border-radius: 5px;
      background-color: #f9f9f9;
      position: relative;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    
    .row + .row {
      margin-top: 35px;
      border-top: 3px solid #888;
      padding-top: 25px;
    }
    
    /* Dodatkowa linia oddzielajƒÖca sekcje */
    .row:after {
      content: '';
      position: absolute;
      bottom: -15px;
      left: 0;
      right: 0;
      height: 2px;
      background-color: #ddd;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    input, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: Arial, sans-serif;
    }
    
    textarea {
      resize: vertical;
      font-family: monospace;
      white-space: pre-wrap;
      min-height: 100px;
      overflow-y: hidden; /* Ukryj domy≈õlny scrollbar */
    }
    
    /* Usu≈Ñ przyciski akcji na dole, bo sƒÖ ju≈º na g√≥rze */
    .actions {
      display: none;
    }
    
    button {
      padding: 8px 15px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    button:hover {
      background-color: #45a049;
    }
    
    button.delete {
      background-color: #f44336;
    }
    
    button.delete:hover {
      background-color: #d32f2f;
    }
    
    button.preview {
      background-color: #2196F3;
    }
    
    button.preview:hover {
      background-color: #0b7dda;
    }
    
    button.copy {
      background-color: #ff9800;
    }
    
    button.copy:hover {
      background-color: #e68a00;
    }
    
    button.save {
      background-color: #9c27b0;
    }
    
    button.save:hover {
      background-color: #7b1fa2;
    }
    
    .toolbar {
      position: sticky;
      top: 0;
      background-color: #333;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      z-index: 100;
      align-items: center;
    }
    
    .toolbar button {
      width: 40px;
      height: 40px;
      font-size: 16px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #555;
    }
    
    .toolbar button.action-btn {
      width: auto;
      padding: 0 15px;
      white-space: nowrap;
    }
    
    .toolbar button:hover {
      background-color: #777;
    }
    
    .toolbar .divider {
      width: 1px;
      background-color: #777;
      margin: 0 5px;
      height: 40px;
    }
    
    .toolbar .sku-input {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-right: auto;
    }
    
    .toolbar .sku-input label {
      color: white;
      margin: 0;
    }
    
    .toolbar .sku-input input {
      width: 100px;
      padding: 8px;
      font-size: 14px;
    }
    
    .toolbar .product-name-input {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .toolbar .product-name-input label {
      color: white;
      margin: 0;
    }
    
    .toolbar .product-name-input input {
      width: 200px;
      padding: 8px;
      font-size: 14px;
    }
    
    .img-preview {
      max-width: 150px;
      max-height: 150px;
      margin-top: 10px;
      border: 1px solid #ddd;
      display: none;
    }
    
    .row-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .link-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 1000;
      display: none;
    }
    
    .link-popup input {
      margin-bottom: 10px;
    }
    
    .link-popup .buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0,0,0,0.5);
      z-index: 999;
      display: none;
    }
    
    /* Specjalne style dla przycisk√≥w "dodaj sekcjƒô" wewnƒÖtrz wiersza */
    .add-inline {
      background-color: #4CAF50;
      margin-left: 10px;
    }

    /* Style dla siatki predefiniowanych cech produktu */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .feature-item {
      display: flex;
      align-items: center;
      padding: 1px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .feature-item:hover {
      background-color: #f0f0f0;
    }

    .feature-item.selected {
      background-color: #e3f2fd;
      border-color: #2196F3;
    }

    .feature-icon {
      width: 100px;
      height: 100px;
      margin-right: 5px;
      object-fit: contain;
    }

    .feature-text {
      flex-grow: 1;
      font-size: 14px;
    }

    /* Style dla przycisk√≥w toggle */
    .toggle-button {
      background-color: #666;
      color: white;
      border: 2px solid transparent;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 12px;
      margin-left: 10px;
    }
    
    .toggle-button.active {
      background-color: #4CAF50;
      border-color: #45a049;
    }
    
    .toggle-button.inactive {
      background-color: #f44336;
      border-color: #d32f2f;
    }

    .info-box {
      background-color: #e3f2fd;
      border: 1px solid #2196F3;
      border-radius: 4px;
      padding: 10px;
      margin-bottom: 15px;
      font-size: 14px;
      color: #1565C0;
    }
  </style>
</head>
<body>
  <!-- Pasek narzƒôdzi -->
  <div class="toolbar">
    <div class="sku-input">
      <label for="sku-number">SKU:</label>
      <input type="text" id="sku-number" placeholder="np. 165" onchange="updateImageNames()">
    </div>
    <div class="product-name-input">
      <label for="product-name">Nazwa produktu:</label>
      <input type="text" id="product-name" placeholder="np. Krem nawil≈ºajƒÖcy" onchange="updateImageNames()">
    </div>
    <div class="divider"></div>
    <button type="button" onclick="formatText('bold')" title="Pogrubienie">B</button>
    <button type="button" onclick="formatText('italic')" title="Kursywa">I</button>
    <button type="button" onclick="formatText('underline')" title="Podkre≈õlenie">U</button>
    <div class="divider"></div>
    <button type="button" onclick="formatText('link')" title="Link">üîó</button>
    <button type="button" onclick="formatText('ul')" title="Lista punktowana">‚Ä¢</button>
    <button type="button" onclick="formatText('ol')" title="Lista numerowana">1.</button>
    <button type="button" onclick="formatText('strong')" title="Wyr√≥≈ºnienie">S</button>
    <button type="button" onclick="formatText('em')" title="Emfaza">E</button>
    <button type="button" onclick="undoLastAction()" title="Cofnij ostatniƒÖ akcjƒô">‚Ü©Ô∏è</button>
    <div class="divider"></div>
    <div style="flex-grow: 1;"></div>
    <button type="button" id="generate-preview" class="preview action-btn" title="PodglƒÖd w nowym oknie">üëÅÔ∏è PodglƒÖd</button>
    <button type="button" id="copy-html" class="copy action-btn" title="Kopiuj kod HTML">üìã Kopiuj HTML</button>
    <button type="button" id="save-html" class="save action-btn" title="Zapisz plik HTML">üíæ Zapisz plik</button>
  </div>
  
  <!-- Popup do wstawiania link√≥w -->
  <div class="overlay" id="overlay"></div>
  <div class="link-popup" id="linkPopup">
    <h3>Wstaw link</h3>
    <label for="linkUrl">URL:</label>
    <input type="text" id="linkUrl" placeholder="https://example.com">
    <label for="linkText">Tekst:</label>
    <input type="text" id="linkText" placeholder="Tekst linku">
    <div class="buttons">
      <button type="button" onclick="closePopup()">Anuluj</button>
      <button type="button" onclick="insertLink()">Wstaw</button>
    </div>
  </div>

  
  
  <div class="container">
  
    <h1> <img src="https://purles.pl/wp-content/uploads/2022/04/logo.png" alt="Purles Logo" class="logo" height="50px" margin-right="120px">  Edytor opis√≥w produkt√≥w Purles v2</h1>
    
    <!-- Sekcja 1: Opis g≈Ç√≥wny -->
    <div class="section" id="description-section">
      <h2>1. Opis g≈Ç√≥wny</h2>
      
      <div id="description-rows">
        <!-- Wiersze opisu bƒôdƒÖ dodawane dynamicznie -->
      </div>
      
      <button type="button" id="add-description-row">Dodaj nowƒÖ sekcjƒô opisu</button>
      
      <div class="form-group" style="margin-top: 20px;">
        <label>Nag≈Ç√≥wek sposobu u≈ºycia:
          <button type="button" class="toggle-button active" id="toggle-usage" onclick="toggleSection('usage')">Poka≈º</button>
        </label>
        <input type="text" id="usage-headline" value="Spos√≥b u≈ºycia:">
      </div>
      
      <div class="form-group">
        <label>Tre≈õƒá sposobu u≈ºycia (HTML):</label>
        <textarea id="usage-content" class="html-content">Nanie≈õ niewielkƒÖ ilo≈õƒá produktu na suchƒÖ sk√≥rƒô twarzy i przez chwilƒô masuj. Nastƒôpnie zemulguj produkt niewielkƒÖ ilo≈õciƒÖ wody. Zmyj wodƒÖ.</textarea>
      </div>
      
      <div class="form-group" style="margin-top: 20px;">
        <label>Nag≈Ç√≥wek rezultat√≥w:
          <button type="button" class="toggle-button active" id="toggle-results" onclick="toggleSection('results')">Poka≈º</button>
        </label>
        <input type="text" id="results-headline" value="Rezultaty:">
      </div>
      
      <div class="form-group">
        <label>Tre≈õƒá rezultat√≥w (HTML):</label>
        <textarea id="results-content" class="html-content"><ul>
<li><strong>100%</strong>&nbsp;os√≥b badanych potwierdzi≈Ço, ≈ºe po zastosowaniu produktu sk√≥ra jest w spos√≥b widoczny nawil≈ºona.*</li>
<li><strong>100%</strong>&nbsp;os√≥b badanych zauwa≈ºy≈Ço, ≈ºe po zastosowaniu produktu nie ma odczucia przesuszenia sk√≥ry, poniewa≈º&nbsp; bariera ochronna jest odbudowana.*</li>
</ul>
<small>* Badanie wykonano na grupie 20 os√≥b.</small></textarea>
      </div>
    </div>
    
    <!-- Sekcja 2: Sk≈Çad -->
    <div class="section" id="composition-section">
      <h2>2. Sk≈Çad</h2>
      
      <div class="form-group">
        <label>Nag≈Ç√≥wek sk≈Çadnik√≥w:</label>
        <input type="text" id="composition-headline" value="Sk≈Çadniki aktywne:">
      </div>
      
      <div class="info-box">
        ‚ÑπÔ∏è Wklej wszystkie sk≈Çadniki aktywne poni≈ºej. Ka≈ºdy sk≈Çadnik zostanie automatycznie umieszczony w osobnym akapicie &lt;p&gt;.
      </div>
      
      <div class="form-group">
        <label>Sk≈Çadniki aktywne (HTML):</label>
        <textarea id="ingredients-content" class="html-content" style="min-height: 200px;"><strong>Bioecolia -</strong> polisacharyd (Œ±-glukan) otrzymany opatentowanƒÖ metodƒÖ enzymatycznej syntezy z cukr√≥w naturalnych. Chroni i stymuluje naturalnƒÖ zdolno≈õƒá obronnƒÖ sk√≥ry poprzez dzia≈Çanie jako bioselektywny substrat (prebiotyk) dla po≈ºytecznych mikroorganizm√≥w, kosztem patogen√≥w. Bioecolia r√≥wnowa≈ºy i stymuluje mikrobiotƒô sk√≥ry, wspomagajƒÖc pierwszƒÖ liniƒô obrony przed atakiem z zewnƒÖtrz.

<strong>Oliwa z oliwek&nbsp;‚Äì</strong> w wiƒôkszo≈õci sk≈Çada siƒô z kwasu oleinowego, kt√≥ry tworzy na powierzchni sk√≥ry delikatnƒÖ warstwƒô ochronnƒÖ, przeciwdzia≈ÇajƒÖc utracie wody. W sk≈Çadzie oliwy obecny jest tak≈ºe kwas linolowy, kt√≥ry redukuje stany zapalne oraz normalizuje proces rogowacenia nask√≥rka. W oliwie znajdziemy r√≥wnie≈º polifenole o w≈Ça≈õciwo≈õciach antyoksydacyjnych i przeciwzapalnych. Oliwa z oliwek zmiƒôkcza i ≈õwietnie ≈Çagodzi podra≈ºnienia wysuszonej sk√≥ry.</textarea>
      </div>
      
      <div class="form-group" style="margin-top: 20px;">
        <label>Pe≈Çen sk≈Çad INCI (HTML):</label>
        <textarea id="inci-content" class="html-content"><strong>Pe≈Çen sk≈Çad (INCI):</strong> Aqua (Water), Paraffinum Liquidum (Mineral Oil), Glycerin, Cetearyl Isononanoate, Cetyl Alcohol, Tapioca Starch, Glyceryl Stearate, PEG-100 Stearate, Pentylene Glycol, Alpha-Glucan Oligosaccharide, Olea Europaea (Olive) Fruit Oil, Capryloyl Glycine, Argania Spinosa Kernel Oil, Parfum (Fragrance), Simmondsia Chinensis (Jojoba) Seed Oil, Propylene Glycol, Carbomer, Xanthan Gum, 1,2-Hexanediol, Caprylyl Glycol, Sodium Hydroxide, Tocopheryl Acetate, Hexamethylindanopyran, Linalyl Acetate, Calendula Officinalis Flower Extract
<br><br>
Sk≈Çad produktu mo≈ºe ulec zmianie. Zalecamy sprawdzenie aktualnego sk≈Çadu INCI na opakowaniu.</textarea>
      </div>
    </div>
    
    <!-- Sekcja 3: Cechy produktu -->
    <div class="section" id="features-section">
      <h2>3. Cechy produktu</h2>
      
      <div class="form-group">
        <label>Nag≈Ç√≥wek sekcji:</label>
        <input type="text" id="features-headline" value="Cechy produktu:">
      </div>
      
      <!-- Siatka z predefiniowanymi cechami produktu -->
      <div class="features-grid" id="predefined-features">
        <!-- Tu bƒôdƒÖ dodane predefiniowane cechy produktu -->
      </div>
      
      <div id="features-container">
        <!-- Wybrane cechy bƒôdƒÖ dodawane dynamicznie -->
      </div>
    </div>
   <p style="text-align: center; color: #8B5CF6;">
 Designed by KS for <strong><a href="https://www.purles.pl" style="color: #8B5CF6; text-decoration: none;">Purl√©s</a></strong>
</p>
    <!-- Akcje -->
    <div class="actions">
      <button type="button" id="generate-preview" class="preview">PodglƒÖd w nowym oknie</button>
      <button type="button" id="copy-html" class="copy">Kopiuj kod HTML</button>
    </div>
  </div>

  <script>
    // Predefiniowane cechy produktu
    const predefinedFeatures = [
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/cruelty_free.png", 
        text: "Przyjazny zwierzƒôtom" 
      },
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/dermatologicaly_tested.png", 
        text: "Testowany dermatologicznie" 
      },
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/gluten_free.png", 
        text: "Nie zawiera glutenu" 
      },
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/natural_ingredients.png", 
        text: "DominujƒÖ sk≈Çadniki naturalnego pochodzenia" 
      },
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/no_harsh_chemicals.png", 
        text: "Nie zawiera agresywnych substancji chemicznych" 
      },
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/no_mineral_oils.png", 
        text: "Nie zawiera olei mineralnych" 
      },
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/no_sls.png", 
        text: "Nie zawiera SLS/SLES" 
      },
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/no_tea.png", 
        text: "Nie zawiera trietanoloaminy" 
      },
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/non_gmo.png", 
        text: "Bez modyfikacji genetycznych" 
      },
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/paraben_free.png", 
        text: "Nie zawiera paraben√≥w" 
      },
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/PEG.png", 
        text: "Nie zawiera substancji z grupy PEG" 
      },
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/petrochemical_free.png", 
        text: "Nie zawiera zwiƒÖzk√≥w pochodnych ropy naftowej" 
      },
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/silicon_free.png", 
        text: "Nie zawiera silikon√≥w" 
      },
      { 
        iconUrl: "https://shop49275-1.yourtechnicaldomain.com/data/include/cms/cechy/vegan.png", 
        text: "Wega≈Ñski" 
      }
    ];
    
    // Dane poczƒÖtkowe
    const initialData = {
      description: {
        rows: [
          {
            imageUrl: "https://shop49275-1.iai-shop.com/data/include/cms/wdrozenie/opisy/image_58.webp",
            headline: "Krem Ochrona Mikrobiomu...",
            content: "‚Ä¶ma dzia≈Çanie ochronne i wielokierunkowe. Specjalny <strong>kompleks prebiotyczny wzmacnia naturalny mikrobiom sk√≥ry</strong> poprzez stymulacjƒô wzrostu po≈ºytecznych bakterii. Oleje zawarte w formule bogate sƒÖ w NNKT, witaminy i antyoksydanty. OdpowiadajƒÖ za <strong>odbudowƒô sk√≥rnej bariery ochronnej,</strong> hamujƒÖc jednocze≈õnie nadmiernƒÖ utratƒô wody i przyczyniajƒÖc siƒô tym samym do <strong>zwiƒôkszenia</strong> poziomu <strong>nawil≈ºenia.</strong> Ekstrakt z nagietka potƒôguje <strong>dzia≈Çanie ≈ÇagodzƒÖce.</strong> Krem <strong>chroni sk√≥rƒô</strong> przed negatywnymi czynnikami zewnƒôtrznymi, <strong>zmniejsza ≈Çuszczenie siƒô i pƒôkanie suchej sk√≥ry. Stosuj rano i / lub wieczorem.</strong>"
          },
          {
            imageUrl: "https://shop49275-1.iai-shop.com/data/include/cms/wdrozenie/opisy/image_59.webp",
            headline: "Wskazania:",
            content: "<ul>\n<li>sk√≥ra wra≈ºliwa, nadreaktywna, alergiczna,</li>\n<li>sk√≥ra ze sk≈Çonno≈õciƒÖ do silnego przesuszenia lub atopii,</li>\n<li>zaburzenia r√≥wnowagi sk√≥ry  wynikajƒÖce z terapii dermatologicznych, a tak≈ºe inwazyjnych zabieg√≥w kosmetycznych.</li>\n</ul>"
          },
          {
            imageUrl: "https://shop49275-1.iai-shop.com/data/include/cms/wdrozenie/opisy/image_60.webp",
            headline: "Dzia≈Çanie:",
            content: "<ul>\n<li>przywraca r√≥wnowagƒô sk√≥rnej mikrobioty,</li>\n<li>wzmacnia barierƒô ochronnƒÖ sk√≥ry,</li>\n<li>intensywnie nawil≈ºa,</li>\n<li>od≈ºywia,</li>\n<li>zmiƒôkcza,</li>\n<li>redukuje szorstko≈õƒá,</li>\n<li>≈Çagodzi podra≈ºnienia.</li>\n</ul>"
          }
        ]
      },
      features: {
        // Domy≈õlnie brak wybranych cech
        items: []
      }
    };
    
    // Zmienna do przechowywania aktywnego elementu
    let activeElement = null;
    
    // Historia akcji dla cofania
    let actionHistory = [];
    
    // Stan widoczno≈õci sekcji
    let sectionVisibility = {
      usage: true,
      results: true
    };
    
    // Funkcja do prze≈ÇƒÖczania widoczno≈õci sekcji
    function toggleSection(section) {
      sectionVisibility[section] = !sectionVisibility[section];
      const button = document.getElementById(`toggle-${section}`);
      
      if (sectionVisibility[section]) {
        button.textContent = 'Poka≈º';
        button.classList.remove('inactive');
        button.classList.add('active');
      } else {
        button.textContent = 'Ukryj';
        button.classList.remove('active');
        button.classList.add('inactive');
      }
    }
    
    // Funkcja do zapisywania akcji w historii
    function saveAction(element, oldValue) {
      console.log('Zapisujƒô akcjƒô do historii:', { element, oldValue });
      if (actionHistory.length >= 50) {
        actionHistory.shift(); // Usu≈Ñ najstarszƒÖ akcjƒô, je≈õli historia jest zbyt d≈Çuga
      }
      actionHistory.push({
        element: element,
        value: oldValue,
        type: 'text-change'
      });
    }
    
    // Funkcja do zapisywania stanu ca≈Çego dokumentu
    function saveDocumentState() {
      const state = {
        type: 'document-state',
        descriptionRows: [],
        ingredientsContent: document.getElementById('ingredients-content').value,
        features: getSelectedFeatures(),
        usageHeadline: document.getElementById('usage-headline').value,
        usageContent: document.getElementById('usage-content').value,
        resultsHeadline: document.getElementById('results-headline').value,
        resultsContent: document.getElementById('results-content').value,
        compositionHeadline: document.getElementById('composition-headline').value,
        inciContent: document.getElementById('inci-content').value,
        featuresHeadline: document.getElementById('features-headline').value
      };
      
      // Zapisz stan wierszy opisu
      document.querySelectorAll("#description-rows .row").forEach(row => {
        state.descriptionRows.push({
          imageUrl: row.querySelector('.desc-image').value,
          headline: row.querySelector('.desc-headline').value,
          content: row.querySelector('.desc-content').value
        });
      });
      
      actionHistory.push(state);
      if (actionHistory.length > 50) {
        actionHistory.shift();
      }
    }
    
    // Funkcja do przywracania stanu dokumentu
    function restoreDocumentState(state) {
      // Usu≈Ñ wszystkie wiersze opisu
      document.getElementById('description-rows').innerHTML = '';
      
      // Przywr√≥ƒá wiersze opisu
      state.descriptionRows.forEach(row => {
        addDescriptionRow(row.imageUrl, row.headline, row.content);
      });
      
      // Przywr√≥ƒá sk≈Çadniki
      document.getElementById('ingredients-content').value = state.ingredientsContent;
      
      // Przywr√≥ƒá cechy
      document.getElementById('features-container').innerHTML = '';
      state.features.forEach(feature => {
        addFeatureToList(feature);
      });
      
      // Przywr√≥ƒá pozosta≈Çe pola
      document.getElementById('usage-headline').value = state.usageHeadline;
      document.getElementById('usage-content').value = state.usageContent;
      document.getElementById('results-headline').value = state.resultsHeadline;
      document.getElementById('results-content').value = state.resultsContent;
      document.getElementById('composition-headline').value = state.compositionHeadline;
      document.getElementById('inci-content').value = state.inciContent;
      document.getElementById('features-headline').value = state.featuresHeadline;
      
      // Zaktualizuj UI
      updateSelectedFeaturesUI();
    }
    
    // Funkcja do cofania ostatniej akcji
    function undoLastAction() {
      console.log('Historia akcji:', actionHistory);
      if (actionHistory.length === 0) {
        alert('Brak akcji do cofniƒôcia');
        return;
      }
      
      const lastAction = actionHistory.pop();
      console.log('Cofam akcjƒô:', lastAction);
      
      if (lastAction.type === 'document-state') {
        restoreDocumentState(lastAction);
      } else if (lastAction.element && document.contains(lastAction.element)) {
        console.log('Przywracam warto≈õƒá:', lastAction.value);
        lastAction.element.value = lastAction.value;
        // Wywo≈Çaj event, kt√≥ry zaktualizuje wysoko≈õƒá textarea
        const event = new Event('input', { bubbles: true });
        lastAction.element.dispatchEvent(event);
        activeElement = lastAction.element;
      } else {
        console.log('Element ju≈º nie istnieje');
        alert('Nie mo≈ºna cofnƒÖƒá tej akcji');
      }
    }
    
    // Funkcja do formatowania tekstu
    function formatText(command) {
      if (!activeElement) {
        alert('Najpierw zaznacz pole tekstowe!');
        return;
      }
      
      // Pobierz aktualne zaznaczenie
      const start = activeElement.selectionStart;
      const end = activeElement.selectionEnd;
      const selectedText = activeElement.value.substring(start, end);
      
      // Zapisz warto≈õƒá przed zmianƒÖ do historii
      const oldValue = activeElement.value;
      console.log('Zapisujƒô stan przed formatowaniem:', oldValue);
      
      let formattedText = '';
      
      switch (command) {
        case 'bold':
          formattedText = `<strong>${selectedText}</strong>`;
          break;
        case 'italic':
          formattedText = `<em>${selectedText}</em>`;
          break;
        case 'underline':
          formattedText = `<u>${selectedText}</u>`;
          break;
        case 'strong':
          formattedText = `<strong>${selectedText}</strong>`;
          break;
        case 'em':
          formattedText = `<em>${selectedText}</em>`;
          break;
        case 'ul':
          if (selectedText.trim() === '') {
            formattedText = "<ul>\n<li></li>\n</ul>";
          } else {
            const lines = selectedText.split('\n');
            formattedText = "<ul>\n" + lines.map(line => `<li>${line.trim()}</li>`).join('\n') + "\n</ul>";
          }
          break;
        case 'ol':
          if (selectedText.trim() === '') {
            formattedText = "<ol>\n<li></li>\n</ol>";
          } else {
            const lines = selectedText.split('\n');
            formattedText = "<ol>\n" + lines.map(line => `<li>${line.trim()}</li>`).join('\n') + "\n</ol>";
          }
          break;
        case 'link':
          // Otw√≥rz popup do wstawiania linku
          document.getElementById('linkText').value = selectedText;
          document.getElementById('overlay').style.display = 'block';
          document.getElementById('linkPopup').style.display = 'block';
          return;
      }
      
      // Wstaw sformatowany tekst
      if (formattedText) {
        activeElement.value = activeElement.value.substring(0, start) + formattedText + activeElement.value.substring(end);
        
        // Ustaw nowƒÖ pozycjƒô kursora
        const newCursorPos = start + formattedText.length;
        activeElement.setSelectionRange(newCursorPos, newCursorPos);
        
        // Zapisz akcjƒô do historii
        saveAction(activeElement, oldValue);
      }
    }
    
    // Funkcja do wstawiania linku
    function insertLink() {
      const linkUrl = document.getElementById('linkUrl').value;
      const linkText = document.getElementById('linkText').value || linkUrl;
      
      if (!linkUrl) {
        alert('Podaj URL linku!');
        return;
      }
      
      const formattedLink = `<a href="${linkUrl}">${linkText}</a>`;
      
      if (activeElement) {
        const oldValue = activeElement.value;
        const start = activeElement.selectionStart;
        const end = activeElement.selectionEnd;
        
        activeElement.value = activeElement.value.substring(0, start) + formattedLink + activeElement.value.substring(end);
        saveAction(activeElement, oldValue);
      }
      
      closePopup();
    }
    
    // Funkcja do zamykania popupu
    function closePopup() {
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('linkPopup').style.display = 'none';
      document.getElementById('linkUrl').value = '';
    }
    
    // Funkcja do aktualizacji nazw obrazk√≥w na podstawie SKU
    function updateImageNames() {
      const sku = document.getElementById('sku-number').value.trim();
      const productName = document.getElementById('product-name').value.trim();
      
      if (!sku) return;
      
      const descRows = document.querySelectorAll("#description-rows .row");
      descRows.forEach((row, index) => {
        const imageInput = row.querySelector('.desc-image');
        const currentUrl = imageInput.value;
        
        // Zachowaj ≈õcie≈ºkƒô, zmie≈Ñ tylko nazwƒô pliku
        const urlParts = currentUrl.split('/');
        const filename = urlParts[urlParts.length - 1];
        
        // Sprawd≈∫ czy to jest placeholder image_XX.webp
        if (filename.match(/image_\d+\.webp/)) {
          urlParts[urlParts.length - 1] = `${sku}_${index + 1}.jpg`;
          imageInput.value = urlParts.join('/');
          updateImagePreview(imageInput);
        }
      });
    }
    
    // Funkcja do generowania tekstu ALT
    function generateAltText() {
      const sku = document.getElementById('sku-number').value.trim();
      const productName = document.getElementById('product-name').value.trim();
      
      let altText = "Purl√©s";
      if (sku) {
        altText += ` ${sku}`;
      }
      if (productName) {
        altText += ` ${productName}`;
      }
      
      return altText.trim();
    }
    
    // Funkcja do dodawania wiersza opisu
    function addDescriptionRow(imageUrl = "", headline = "", content = "", afterElement = null) {
      // Zapisz stan dokumentu przed dodaniem
      saveDocumentState();
      
      const container = document.getElementById("description-rows");
      const rowId = "desc-row-" + Date.now();
      
      const rowHtml = `
        <div class="row" id="${rowId}">
          <div class="form-group">
            <label>URL obrazka:</label>
            <input type="text" class="desc-image" value="${imageUrl}" onchange="updateImagePreview(this)">
            <img src="${imageUrl}" class="img-preview" style="${imageUrl ? 'display:block' : ''}">
          </div>
          
          <div class="form-group">
            <label>Nag≈Ç√≥wek:</label>
            <input type="text" class="desc-headline" value="${headline}">
          </div>
          
          <div class="form-group">
            <label>Tre≈õƒá (HTML):</label>
            <textarea class="desc-content html-content">${content}</textarea>
          </div>
          
          <div class="row-actions">
            <button type="button" class="delete" onclick="removeElement('${rowId}')">Usu≈Ñ sekcjƒô</button>
            <button type="button" class="add-inline" onclick="addDescriptionRow('', '', '', document.getElementById('${rowId}'))">Dodaj sekcjƒô po tej</button>
          </div>
        </div>
      `;
      
      if (afterElement) {
        afterElement.insertAdjacentHTML('afterend', rowHtml);
      } else {
        container.insertAdjacentHTML('beforeend', rowHtml);
      }
      
      // Dodaj listener dla tekst√≥w
      const newRow = document.getElementById(rowId);
      setupTextareaListeners(newRow.querySelector('.html-content'));
      setupInputListeners(newRow.querySelector('.desc-headline'));
      setupInputListeners(newRow.querySelector('.desc-image'));
    }
    
    // Funkcja do aktualizacji podglƒÖdu obrazka
    function updateImagePreview(input) {
      const preview = input.nextElementSibling;
      if (input.value) {
        preview.src = input.value;
        preview.style.display = 'block';
      } else {
        preview.style.display = 'none';
      }
    }
    
    // Funkcja do przetworzenia sk≈Çadnik√≥w - ka≈ºdy sk≈Çadnik w osobnym <p>
    function processIngredients(content) {
      // Usu≈Ñ puste linie i znaki bia≈Çe na poczƒÖtku i ko≈Ñcu
      const trimmedContent = content.trim();
      
      // Podziel na linie
      const lines = trimmedContent.split(/\n+/);
      
      // Przefiltruj puste linie i przygotuj HTML
      const processedLines = lines
        .map(line => line.trim())
        .filter(line => line.length > 0)
        .map(line => `  <p>${line}</p>`);
      
      return processedLines.join('\n');
    }
    
    // Funkcja do dodawania wybranej cechy produktu do listy
    function addFeatureToList(feature) {
      const container = document.getElementById("features-container");
      const featureId = "selected-feature-" + Date.now();
      
      const featureHtml = `
        <div class="row" id="${featureId}">
          <div class="form-group">
            <label>Cecha produktu:</label>
            <div style="display: flex; align-items: center;">
              <img src="${feature.iconUrl}" alt="" style="width: 40px; height: 40px; margin-right: 10px;">
              <span>${feature.text}</span>
            </div>
          </div>
          
          <div class="row-actions">
            <button type="button" class="delete" onclick="removeElement('${featureId}')">Usu≈Ñ cechƒô</button>
          </div>
        </div>
      `;
      
      container.insertAdjacentHTML('beforeend', featureHtml);
      
      // Od≈õwie≈º wybrane cechy w interfejsie
      updateSelectedFeaturesUI();
    }
    
    // Funkcja do obs≈Çugi wyboru predefiniowanej cechy
    function toggleFeature(index) {
      // Zapisz stan dokumentu przed zmianƒÖ
      saveDocumentState();
      
      const feature = predefinedFeatures[index];
      const featureElement = document.querySelector(`#feature-item-${index}`);
      
      if (featureElement.classList.contains('selected')) {
        // Usu≈Ñ cechƒô z wybranych
        featureElement.classList.remove('selected');
        
        // Znajd≈∫ i usu≈Ñ odpowiadajƒÖcy element z listy wybranych cech
        const selectedFeatures = getSelectedFeatures();
        const featureContainer = document.getElementById("features-container");
        const featureRows = featureContainer.querySelectorAll('.row');
        
        for (const row of featureRows) {
          const imgSrc = row.querySelector('img').src;
          if (imgSrc === feature.iconUrl) {
            row.remove();
            break;
          }
        }
      } else {
        // Dodaj cechƒô do wybranych
        featureElement.classList.add('selected');
        addFeatureToList(feature);
      }
    }
    
    // Funkcja do aktualizacji UI dla wybranych cech
    function updateSelectedFeaturesUI() {
      const selectedFeatures = getSelectedFeatures();
      const predefinedGrid = document.getElementById("predefined-features");
      const featureItems = predefinedGrid.querySelectorAll('.feature-item');
      
      // Zaznacz odpowiednie elementy w siatce predefiniowanych cech
      featureItems.forEach((item, index) => {
        const feature = predefinedFeatures[index];
        const isSelected = selectedFeatures.some(f => f.iconUrl === feature.iconUrl);
        
        if (isSelected) {
          item.classList.add('selected');
        } else {
          item.classList.remove('selected');
        }
      });
    }
    
    // Funkcja do pobierania aktualnie wybranych cech
    function getSelectedFeatures() {
      const featureContainer = document.getElementById("features-container");
      const featureRows = featureContainer.querySelectorAll('.row');
      const selectedFeatures = [];
      
      featureRows.forEach(row => {
        const imgSrc = row.querySelector('img').src;
        const text = row.querySelector('span').textContent;
        
        selectedFeatures.push({
          iconUrl: imgSrc,
          text: text
        });
      });
      
      return selectedFeatures;
    }
    
    // Funkcja do usuwania elementu
    function removeElement(elementId) {
      // Zapisz stan dokumentu przed usuniƒôciem
      saveDocumentState();
      
      const element = document.getElementById(elementId);
      if (element) {
        // Je≈õli to jest wybrana cecha, zaktualizuj r√≥wnie≈º UI w siatce
        if (elementId.startsWith('selected-feature-')) {
          const featureText = element.querySelector('span').textContent;
          const featureItems = document.querySelectorAll('.feature-item');
          
          featureItems.forEach(item => {
            if (item.querySelector('.feature-text').textContent === featureText) {
              item.classList.remove('selected');
            }
          });
        }
        
        element.remove();
      }
    }
    
    // Funkcja do generowania HTML
    function generateHtml() {
      let html = '';
      
      // 1. Opis g≈Ç√≥wny
      html += '<!-- ZAK≈ÅADKA OPIS -->\n';
      html += '<div id="description" class="desc">\n';
      
      // Wiersze opisu
      const descRows = document.querySelectorAll("#description-rows .row");
      const altText = generateAltText();
      
      descRows.forEach(row => {
        const imageUrl = row.querySelector('.desc-image').value;
        const headline = row.querySelector('.desc-headline').value;
        const content = row.querySelector('.desc-content').value;
        
        html += '  <div class="desc__row">\n';
        html += '    <div class="desc__image">\n';
        html += `      <img src="${imageUrl}" alt="${altText}" loading="lazy">\n`;
        html += '    </div>\n';
        html += '    <div class="desc__content">\n';
        html += `      <h3 class="desc__headline">${headline}</h3>\n`;
        html += `      <p>\n        ${content}\n      </p>\n`;
        html += '    </div>\n';
        html += '  </div>\n';
      });
      
      // Spos√≥b u≈ºycia
      if (sectionVisibility.usage) {
        const usageHeadline = document.getElementById('usage-headline').value;
        const usageContent = document.getElementById('usage-content').value;
        
        html += '  <div class="desc__results">\n';
        html += `    <h3 class="desc__headline">${usageHeadline}</h3>\n`;
        html += `    ${usageContent}\n`;
        html += '  </div>\n';
      } else {
        const usageHeadline = document.getElementById('usage-headline').value;
        const usageContent = document.getElementById('usage-content').value;
        
        html += '  <!-- Sekcja spos√≥b u≈ºycia ukryta\n';
        html += '  <div class="desc__results">\n';
        html += `    <h3 class="desc__headline">${usageHeadline}</h3>\n`;
        html += `    ${usageContent}\n`;
        html += '  </div>\n';
        html += '  -->\n';
      }
      
      // Rezultaty
      if (sectionVisibility.results) {
        const resultsHeadline = document.getElementById('results-headline').value;
        const resultsContent = document.getElementById('results-content').value;
        
        html += '  <div class="desc__results">\n';
        html += `    <h3 class="desc__headline">${resultsHeadline}</h3>\n`;
        html += `    ${resultsContent}\n`;
        html += '  </div>\n';
      } else {
        const resultsHeadline = document.getElementById('results-headline').value;
        const resultsContent = document.getElementById('results-content').value;
        
        html += '  <!-- Sekcja rezultaty ukryta\n';
        html += '  <div class="desc__results">\n';
        html += `    <h3 class="desc__headline">${resultsHeadline}</h3>\n`;
        html += `    ${resultsContent}\n`;
        html += '  </div>\n';
        html += '  -->\n';
      }
      html += '</div>\n\n';
      
      // 2. Sk≈Çad
      html += '<!-- ZAK≈ÅADKA SK≈ÅAD -->\n';
      html += '<div id="composition" class="desc">\n';
      
      // Nag≈Ç√≥wek sk≈Çadnik√≥w
      const compositionHeadline = document.getElementById('composition-headline').value;
      html += `  <h3 class="desc__headline">${compositionHeadline}</h3>\n`;
      
      // Sk≈Çadniki - teraz przetwarzamy zawarto≈õƒá pola tekstowego
      const ingredientsContent = document.getElementById('ingredients-content').value;
      const processedIngredients = processIngredients(ingredientsContent);
      html += processedIngredients + '\n';
      
      // INCI
      const inciContent = document.getElementById('inci-content').value;
      html += '  <div class="desc__results">\n';
      html += `    <p>${inciContent}</p>\n`;
      html += '  </div>\n';
      html += '</div>\n\n';
      
      // 3. Cechy produktu
      html += '<!-- ZAK≈ÅADKA CECHY PRODUKTU -->\n';
      html += '<div id="feature" class="desc">\n';
      
      // Nag≈Ç√≥wek cech
      const featuresHeadline = document.getElementById('features-headline').value;
      html += `  <h3 class="desc__headline">${featuresHeadline}</h3>\n`;
      html += '  <div class="desc__features">\n';
      
      // Wybrane cechy
      const selectedFeatures = getSelectedFeatures();
      selectedFeatures.forEach(feature => {
        html += '    <div class="desc__feature">\n';
        html += `      <div class="desc__icon"><img src="${feature.iconUrl}" alt="" loading="lazy"></div><span>${feature.text}</span></div>\n`;
      });
      
      html += '  </div>\n';
      html += '</div>';
      
      return html;
    }
    
    // Funkcja do otwierania podglƒÖdu w nowym oknie
    function openPreview() {
      const html = generateHtml();
      
      // CSS dla podglƒÖdu
      const css = `
        .desc {
          font-family: Arial, sans-serif;
          line-height: 1.6;
          max-width: 1000px;
          margin: 0 auto;
          padding: 20px;
        }
        
        .desc__row {
          display: flex;
          margin-bottom: 2rem;
          align-items: flex-start;
        }
        
        .desc__image {
          flex: 0 0 200px;
          margin-right: 1.5rem;
        }
        
        .desc__image img {
          max-width: 100%;
          height: auto;
        }
        
        .desc__content {
          flex: 1;
        }
        
        .desc__headline {
          font-size: 1.25rem;
          font-weight: 600;
          margin-bottom: 0.75rem;
        }
        
        .desc ul {
          padding-left: 1.5rem;
          margin-bottom: 1rem;
        }
        
        .desc__usage,
        .desc__results {
          margin-top: 1.5rem;
          padding: 1rem;
          background-color: #f9f9f9;
          border-radius: 0.375rem;
        }
        
        .desc__features {
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
        }
        
        .desc__feature {
          display: flex;
          align-items: center;
          flex: 0 0 calc(25% - 1rem);
          min-width: 200px;
        }
        
        .desc__icon {
          width: 40px;
          height: 40px;
          margin-right: 0.5rem;
        }
        
        .desc__icon img {
          max-width: 100%;
          height: auto;
        }
        
        @media (max-width: 768px) {
          .desc__row {
            flex-direction: column;
          }
          
          .desc__image {
            margin-right: 0;
            margin-bottom: 1rem;
            flex: none;
            width: 100%;
          }
          
          .desc__feature {
            flex: 0 0 100%;
          }
        }
      `;
      
      // Otw√≥rz nowe okno i dodaj tre≈õƒá HTML
      const previewWindow = window.open('', '_blank');
      previewWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>PodglƒÖd opisu produktu</title>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <style>${css}</style>
        </head>
        <body>
          ${html}
        </body>
        </html>
      `);
      previewWindow.document.close();
    }
    
    // Funkcja do zapisywania pliku HTML
    function saveHtmlFile() {
      const html = generateHtml();
      const sku = document.getElementById('sku-number').value.trim();
      
      // Ustal nazwƒô pliku
      let filename = 'opis-produktu.html';
      if (sku) {
        filename = `${sku}.html`;
      } else {
        // Pobierz pierwszy nag≈Ç√≥wek jako nazwƒô pliku
        const firstHeadline = document.querySelector('.desc-headline');
        if (firstHeadline && firstHeadline.value) {
          // Usu≈Ñ niedozwolone znaki z nazwy pliku
          filename = firstHeadline.value.replace(/[^a-zA-Z0-9ƒÖƒáƒô≈Ç≈Ñ√≥≈õ≈∫≈ºƒÑƒÜƒò≈Å≈É√ì≈ö≈π≈ª\s-]/g, '').trim() + '.html';
        }
      }
      
      // Utw√≥rz blob z zawarto≈õciƒÖ HTML
      const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
      
      // Utw√≥rz link do pobrania
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      
      // Kliknij link, aby pobraƒá plik
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      // Zwolnij pamiƒôƒá
      URL.revokeObjectURL(link.href);
    }
    
    // Funkcja do ustawienia aktywnego elementu i auto-resize
    function setupTextareaListeners(textarea) {
      textarea.addEventListener('focus', function() {
        activeElement = this;
      });
      
      textarea.addEventListener('blur', function() {
        // Nie resetujemy activeElement tutaj, aby mo≈ºna by≈Ço u≈ºywaƒá przycisk√≥w po klikniƒôciu na nie
      });
      
      // Zapisz stan przed ka≈ºdƒÖ zmianƒÖ
      textarea.addEventListener('keydown', function(e) {
        // Zapisz stan tylko dla klawiszy, kt√≥re mogƒÖ zmieniƒá zawarto≈õƒá
        if (!e.ctrlKey && !e.metaKey && e.key !== 'Tab' && e.key !== 'Shift' && e.key !== 'Control' && e.key !== 'Alt') {
          const oldValue = this.value;
          setTimeout(() => {
            if (this.value !== oldValue) {
              saveAction(this, oldValue);
            }
          }, 0);
        }
      });
      
      // Auto-resize dla textarea
      textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
      });
      
      // Inicjalne ustawienie wysoko≈õci
      setTimeout(function() {
        textarea.style.height = 'auto';
        textarea.style.height = (textarea.scrollHeight) + 'px';
      }, 0);
    }
    
    // Funkcja do ustawienia listener√≥w dla input√≥w
    function setupInputListeners(input) {
      input.addEventListener('focus', function() {
        activeElement = this;
      });
      
      // Zapisz stan przed ka≈ºdƒÖ zmianƒÖ
      input.addEventListener('keydown', function(e) {
        // Zapisz stan tylko dla klawiszy, kt√≥re mogƒÖ zmieniƒá zawarto≈õƒá
        if (!e.ctrlKey && !e.metaKey && e.key !== 'Tab' && e.key !== 'Shift' && e.key !== 'Control' && e.key !== 'Alt') {
          const oldValue = this.value;
          setTimeout(() => {
            if (this.value !== oldValue) {
              saveAction(this, oldValue);
            }
          }, 0);
        }
      });
    }
    
    // Funkcja do renderowania predefiniowanych cech
    function renderPredefinedFeatures() {
      const container = document.getElementById("predefined-features");
      
      predefinedFeatures.forEach((feature, index) => {
        const featureItem = document.createElement('div');
        featureItem.className = 'feature-item';
        featureItem.id = `feature-item-${index}`;
        featureItem.onclick = () => toggleFeature(index);
        
        featureItem.innerHTML = `
          <img src="${feature.iconUrl}" alt="" class="feature-icon">
          <div class="feature-text">${feature.text}</div>
        `;
        
        container.appendChild(featureItem);
      });
    }
    
    // Inicjalizacja strony
    document.addEventListener('DOMContentLoaded', function() {
      // Renderuj predefiniowane cechy
      renderPredefinedFeatures();
      
      // Dodaj poczƒÖtkowe dane
      initialData.description.rows.forEach(row => {
        addDescriptionRow(row.imageUrl, row.headline, row.content);
      });
      
      // Nie dodajemy ≈ºadnych cech domy≈õlnie - u≈ºytkownik wybierze sam
      
      // Obs≈Çuga przycisk√≥w
      document.getElementById('add-description-row').addEventListener('click', function() {
        addDescriptionRow();
      });
      
      // Przyciski w toolbarze
      document.getElementById('generate-preview').addEventListener('click', openPreview);
      
      document.getElementById('copy-html').addEventListener('click', function() {
        const html = generateHtml();
        navigator.clipboard.writeText(html)
          .then(() => alert('Kod HTML zosta≈Ç skopiowany do schowka!'))
          .catch(err => {
            console.error('B≈ÇƒÖd podczas kopiowania:', err);
            alert('Nie uda≈Ço siƒô skopiowaƒá kodu. Spr√≥buj rƒôcznie zaznaczyƒá i skopiowaƒá.');
          });
      });
      
      // Przycisk zapisywania pliku
      document.getElementById('save-html').addEventListener('click', saveHtmlFile);
      
      // Dodaj nas≈Çuchiwacze zdarze≈Ñ dla wszystkich p√≥l tekstowych z klasƒÖ html-content
      document.querySelectorAll('.html-content').forEach(textarea => {
        setupTextareaListeners(textarea);
      });
      
      // Dodaj nas≈Çuchiwacz dla sposobu u≈ºycia i rezultat√≥w
      setupTextareaListeners(document.getElementById('usage-content'));
      setupTextareaListeners(document.getElementById('results-content'));
      setupTextareaListeners(document.getElementById('inci-content'));
      setupTextareaListeners(document.getElementById('ingredients-content'));
      
      // Dodaj nas≈Çuchiwacze dla input√≥w
      setupInputListeners(document.getElementById('usage-headline'));
      setupInputListeners(document.getElementById('results-headline'));
      setupInputListeners(document.getElementById('composition-headline'));
      setupInputListeners(document.getElementById('features-headline'));
      setupInputListeners(document.getElementById('product-name'));
      
      // Zamykanie popupu po klikniƒôciu w overlay
      document.getElementById('overlay').addEventListener('click', closePopup);
    });
  </script>
</body>
</html>
